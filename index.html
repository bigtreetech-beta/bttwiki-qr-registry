<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bigtreetech Wiki</title>
    <style>
        /* ----------- css color ----------- */
        :root {
            --color-bg-dark: #0d0d0d;
            --color-bg-card: #1a1a1a;
            --color-text-light: #e4e4e4;
            --color-text-muted: #cfcfcf;
            --color-primary: #4b6cff;
            --color-error: #ff6b6b;
            --shadow-card: 0 8px 25px rgba(0,0,0,0.5);
            --shadow-btn: 0 4px 12px rgba(75,108,255,0.25);
            --shadow-btn-hover: 0 6px 18px rgba(75,108,255,0.35);
        }

        /* ----------- global base ----------- */
        html, body {
            margin: 0;
            padding: 0;
            font-family: "HarmonyOS Sans", sans-serif;
            background: var(--color-bg-dark);
            color: var(--color-text-light);
            height: 100%;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        /* ----------- Product card ----------- */
        #product {
            width: 100%;
            padding: 20px; 
            box-sizing: border-box;
        }

        .product-card {
            background: var(--color-bg-card);
            border-radius: 14px;
            box-shadow: var(--shadow-card);
            padding: 32px;
            max-width: 600px; 
            margin: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            animation: fadeIn 0.4s ease;
            word-break: break-word;
        }

        /* ----------- Logo css config ----------- */
        .logo {
            width: 300px;
            max-width: 60%;
            margin-bottom: 24px;
            height: auto;
        }

        /* ----------- Animation ----------- */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(12px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ----------- title h2 ----------- */
        .product-card h2 {
            font-size: 2rem;
            font-weight: 600;
            margin: 0 0 12px 0;
            text-align: center;
        }

        /* ----------- description ----------- */
        .product-desc {
            font-size: 1.00rem;
            line-height: 1.7;
            color: var(--color-text-muted);
            text-align: center;
            margin-bottom: 30px;
        }

        /* ----------- link button ----------- */
        .btn-link {
            background: var(--color-primary);
            color: #fff;
            border-radius: 8px;
            text-decoration: none;
            font-size: 1rem;
            padding: 14px 24px;
            display: block;
            transition: 0.25s;
            box-shadow: var(--shadow-btn);
            width: 100%;
            max-width: 280px;
            text-align: center;
            box-sizing: border-box;
            font-weight: 600;
        }

        .btn-link:hover {
            background: #7590ff;
            transform: translateY(-2px);
            box-shadow: var(--shadow-btn-hover);
        }

        /* ----------- error ----------- */
        .error-text {
            color: var(--color-error);
            font-size: 1.1rem;
            text-align: center;
            margin-top: 20px;
        }

        /* ----------- for 768px ----------- */
        @media (max-width: 768px) {
            .product-card {
                padding: 24px;
            }
            .product-card h2 {
                font-size: 1.8rem;
            }
            .product-desc {
                font-size: 1rem;
            }
        }

        /* ----------- for 480px ----------- */
        @media (max-width: 480px) {
            #product {
                padding: 10px;
            }
            .product-card {
                padding: 20px;
                border-radius: 10px;
            }
            .product-card h2 {
                font-size: 1.5rem;
            }
            .product-desc {
                font-size: 0.95rem;
                margin-bottom: 25px;
            }
            .btn-link {
                padding: 12px 18px;
                font-size: 0.95rem;
                max-width: 100%;
            }
        }
    </style>
</head>
<body>

    <div id="product"></div>             

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const uuid = urlParams.get("uuid");
        const div = document.getElementById("product");

        if (!uuid) {
            div.innerHTML = `<p class="error-text">missing uuid parameter</p>`;
            throw new Error("Missing uuid");
        }

        // ====== uuid -> product json filename ======
        // n-xxx  => product-xxx.json
        const productId = uuid.replace(/^n-/, "product-");
        const productFilePath = `product-base/${productId}.json`;

        // ====== i18n ======
        const browserLang = navigator.language.toLowerCase();
        const langMap = {
            "zh-cn": "zh-cn",
            "zh": "zh-cn",
            "en": "en-us",
            "en-us": "en-us"
        };
        const currentLang = langMap[browserLang] || "en-us";
        const i18nFilePath = `i18n/${currentLang}.json`;

        let i18n_open_product_page_fallback = "Open in Bigtreetech Wiki";
        let i18n_open_product_page = i18n_open_product_page_fallback;

        // ====== load i18n ======
        fetch(i18nFilePath)
            .then(res => res.ok ? res.json() : {})
            .then(i18nTexts => {
                i18n_open_product_page =
                    i18nTexts.open_product_page || i18n_open_product_page_fallback;

                // ====== load single product json ======
                return fetch(productFilePath);
            })
            .then(res => {
                if (!res.ok) {
                    throw new Error(`Failed to load ${productFilePath}`);
                }
                return res.json();
            })
            .then(product => {
                // fix missing data
                const desc = product.description?.[currentLang] || "No description available...";
                const url  = product.redirectUrl?.[currentLang] || "#";
                const name = product.name || "Product";

                div.innerHTML = `
                    <div class="product-card">
                        <img src="logo.svg" class="logo" alt="logo">
                        <h2>${name}</h2>
                        <p class="product-desc">${desc}</p>
                        <a class="btn-link" href="${url}" target="_blank">
                            ${i18n_open_product_page}
                        </a>
                    </div>
                `;
            })
            .catch(error => {
                div.innerHTML = `<p class="error-text">Error: ${error.message}</p>`;
            });
    </script>

</body>
</html>
